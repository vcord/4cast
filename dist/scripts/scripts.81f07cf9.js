"use strict";angular.module("4castApp",["ngAnimate","ngAria","ngCookies","ngResource","ui.router","ngSanitize","ngTouch","angular-loading-bar","angularMoment","toastr","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","cfpLoadingBarProvider",function(a,b,c,d){c.html5Mode(!0),a.state("home",{url:"/",controller:"GeoCtrl",templateUrl:"views/main.html"}),b.otherwise("/"),d.includeSpinner=!0,d.includeBar=!0}]).run(["$rootScope",function(a){a.API={google:{key:"AIzaSyBKk8Dtb_C-fwCH9A61Fp_utGCHPx-reFA",url:"https://maps.googleapis.com/maps/api/geocode/json"},openweather:{key:"93be51540090e5825beb7296aa0b1394",url:"http://api.openweathermap.org/data/2.5/weather"}}}]),angular.module("4castApp").service("findme",["$log","$http","$q","$window","$timeout",function(a,b,c,d,e){var f={};return f.now=function(){var a,b=e(function(){a.reject(1)},5e3);return a=c.defer(),d.navigator.geolocation?d.navigator.geolocation.getCurrentPosition(function(c){return e.cancel(b),a.resolve(c)},function(c){return e.cancel(b),a.reject(c.code||1)},{enableHighAccuracy:!0,timeout:1/0,maximumAge:0}):(e.cancel(b),a.reject(!1)),a.promise},f}]),angular.module("4castApp").service("vcordDB",["$window",function(a){var b={};return b.table=function(b){if(a.localStorage.getItem(b))return!1;var c={db:[]},d=JSON.stringify(c);return a.localStorage.setItem(b,d)},b.Insert=function(b,c){var d=a.localStorage.getItem(b),e=JSON.parse(d),f=(e.db.push(c),JSON.stringify(e));a.localStorage.setItem(b,f)},b.FetchAll=function(b){var c=a.localStorage.getItem(b);if(c){var d=JSON.parse(c),e=d.db;return e}return!1},b.Count=function(b){var c=a.localStorage.getItem(b);if(c){var d=JSON.parse(c),e=d.db.length;return e}return!1},b.DeleteAll=function(b){var c=a.localStorage.getItem(b);if(!c)return!1;var d={db:[]},e=JSON.stringify(d);a.localStorage.setItem(b,e)},b}]),angular.module("4castApp").controller("GeoCtrl",["$scope","$http","toastr","$window","$state","findme","$rootScope","vcordDB",function(a,b,c,d,e,f,g,h){a.LoadWeather=h.FetchAll("myGeo"),a.WeatherCount=h.Count("myGeo"),a.getLocation=function(){f.now().then(function(d){var e=d.coords;h.Count("myGeo")<0||!h.Count("myGeo")?b.jsonp(g.API.openweather.url,{params:{lat:e.latitude,lon:e.longitude,appid:g.API.openweather.key,callback:"JSON_CALLBACK"}}).then(function(b){a.$broadcast("ShowWeather",b.data)}):c.warning("Oops!! you already have a History, Please check your weather manually!")},function(b){if(b===!1&&c.warning("Your browser does not support Html5 Geolocation API"),1===b){if(h.Count("myGeo")<0||!h.Count("myGeo"))return a.$broadcast("UserReject","rejected");c.warning("Oops!! you already have a History, Please check your weather manually!")}2===b&&c.warning("Your current position is not available. Please check your internet connection.")})},a.SaveWeather=function(){a.$on("saveWeather",function(b,c){h.table("myGeo");var e={ref_id:a.uniqeId(10),location:c.name,weather:a.ToCelcius(c.main.temp),wind:a.ToKilometer(c.wind.speed),humidity:c.main.humidity,description:c.weather[0].description,date:new Date};h.Insert("myGeo",e),d.location.reload()})},a.clearHistory=function(){h.DeleteAll("myGeo"),d.location.reload()},a.ToCelcius=function(a){var b=a-273.15,c=Math.round(b);return c},a.ToKilometer=function(a){var b=3.6*a,c=Math.round(100*b)/100;return c},a.uniqeId=function(a){for(var b="",c=function(){var a=Math.floor(62*Math.random());return a<10?a:a<36?String.fromCharCode(a+55):String.fromCharCode(a+61)};b.length<a;)b+=c();return b},a.SaveWeather()}]),angular.module("4castApp").controller("GeoformCtrl",["$scope","$rootScope","$http",function(a,b,c){a.formGeoLocate={},a.getLocation=function(d){return c.get(b.API.google.url,{params:{address:d,sensor:!1,key:b.API.google.key}}).then(function(b){return b.data.results.map(function(b){return a.formGeoLocate=b.geometry.location,b.formatted_address})})},a.showWeather=function(d){c.jsonp(b.API.openweather.url,{params:{lat:d.lat,lon:d.lng,appid:b.API.openweather.key,callback:"JSON_CALLBACK"}}).then(function(b){a.$emit("ShowWeather",b.data)})}}]),angular.module("4castApp").controller("ModalCtrl",["$scope","$uibModal","$document","$rootScope",function(a,b,c,d){a.showReject=function(){a.$on("UserReject",function(a,c){b.open({backdrop:"static",templateUrl:"views/partials/modal_home.html",size:"sm",controller:"ModalinstanceCtrl"})})},a.showManual=function(){b.open({templateUrl:"views/partials/modal_home.html",size:"sm",controller:"ModalinstanceCtrl"})},a.showWeatherForm=function(){a.$on("ShowWeather",function(a,c){d.weatherData=c;b.open({backdrop:"static",templateUrl:"views/partials/modal_weather.html",size:"sm",controller:"ModalinstanceCtrl"})})},a.showReject(),a.showWeatherForm()}]),angular.module("4castApp").controller("ModalinstanceCtrl",["$scope","$rootScope","$uibModalInstance",function(a,b,c){a.saveWeather=function(b){a.$broadcast("saveWeather",b),c.close()},a.close=function(){c.close()},a.cancel=function(){c.dismiss("cancel")}}]),angular.module("4castApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/main.html",'<div class="container" ng-controller="GeoCtrl"> <div ng-controller="ModalCtrl"></div> <div class="row"> <div class="col-xs-12" ng-init="getLocation()"> <div class="panel panel-default"> <div class="panel-heading app-panel">Forecast History <button class="btn btn-red btn-circle pull-right" ng-click="clearHistory()">Clear History</button></div> <div class="list-group" ng-repeat="info in LoadWeather"> <div class="list-group-item weather-bag" style="overflow:hidden"> <div class="col-xs-6"> <h3>{{info.location}} <span class="badge badge-mine">Ref ID: {{info.ref_id}}</span></h3> <h4>{{info.description}}</h4> <p class="meta info">{{info.weather}}&deg;<span>C</span></p> </div> <div class="col-xs-6"> <div class="sub-meta pull-right"> <h4>Humidity: {{info.humidity}}%</h4> <h4>Wind: {{info.wind}}km/h</h4> <h4 am-time-ago="info.date"></h4> </div> </div> </div> </div> </div> </div> </div> </div>'),a.put("views/partials/modal_home.html",'<div ng-controller="ModalCtrl"> <div class="modal-header"> <h5 class="modal-title text-center text-muted" id="modal-title">Please Provide Your Zip Code or City Name For Weather Forecast:</h5> </div> <div ng-controller="GeoformCtrl"> <div class="modal-body text-center" id="modal-body"> <input type="text" ng-model="asyncSelected" placeholder="Enter Your City,country,zip code etc" uib-typeahead="address for address in getLocation($viewValue)" typeahead-loading="loadingLocations" typeahead-no-results="noResults" class="form-control"> <i ng-show="loadingLocations" class="glyphicon glyphicon-refresh"></i> <div ng-show="noResults"> <i class="glyphicon glyphicon-remove"></i> No Results Found </div> </div> <div class="modal-footer"> <button class="btn btn-circle btn-green" type="button" ng-click="showWeather(formGeoLocate)">Show Weather</button> </div> </div> </div>'),a.put("views/partials/modal_weather.html",'<div ng-controller="ModalCtrl"> <div ng-controller="GeoCtrl"> <div class="modal-header"> <h3 class="modal-title text-center" id="modal-title">{{weatherData.name}} Current Weather</h3> </div> <div class="modal-body" id="modal-body"> <div class="weather-bag" style="overflow:hidden"> <h3>{{weatherData.name}}</h3> <h4>{{weatherData.weather[0].description}}</h4> <img src="views/img/therm.svg" class="img-responsive info" width="70"> <p class="meta info">{{ToCelcius(weatherData.main.temp)}}ยบ<span>C</span></p> <div class="sub-meta pull-right"> <h4>Humidity: {{weatherData.main.humidity}}%</h4> <h4>Wind: {{ToKilometer(weatherData.wind.speed)}}km/h</h4> </div> </div> </div> <div class="modal-footer"> <button class="btn btn-circle btn-green" type="button" ng-click="saveWeather(weatherData)">Save &amp; Close</button> </div> </div> </div>')}]);